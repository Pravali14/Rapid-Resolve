<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapid Resolve App</title>
    <style>
        /* Styles remain unchanged */
    </style>
</head>
<body>
    <h1>Welcome to Rapid Resolve</h1>
    <div id="message"></div>

    <!-- Role Selection -->
    <div class="container" id="role-selection">
        <h2>Select Your Role</h2>
        <button onclick="showUserSignup()">User</button>
        <button onclick="showTeamLeaderSignup()">Team Leader</button>
    </div>

    <!-- User Signup Form -->
    <div class="form-container" id="user-signup">
        <h2>User Signup</h2>
        <input type="text" id="user-username" placeholder="Username" required>
        <input type="email" id="user-email" placeholder="Email" required>
        <input type="text" id="user-org" placeholder="Organization" required>
        <input type="password" id="user-password" placeholder="Password" required>
        <button onclick="signupUser()">Sign Up</button>
        <button onclick="showRoleSelection()">Back</button>
    </div>

    <!-- Team Leader Signup Form -->
    <div class="form-container" id="team-leader-signup">
        <h2>Team Leader Signup</h2>
        <input type="text" id="team-leader-username" placeholder="Username" required>
        <input type="email" id="team-leader-email" placeholder="Email" required>
        <input type="text" id="team-leader-org" placeholder="Organization" required>
        <input type="password" id="team-leader-password" placeholder="Password" required>
        <button onclick="signupTeamLeader()">Sign Up</button>
        <button onclick="showRoleSelection()">Back</button>
    </div>

    <!-- User Login Form -->
    <div class="form-container" id="user-login">
        <h2>User Login</h2>
        <input type="text" id="login-user-username" placeholder="Username" required>
        <input type="password" id="login-user-password" placeholder="Password" required>
        <button onclick="loginUser()">Login</button>
        <button onclick="showRoleSelection()">Back</button>
    </div>

    <!-- Team Leader Login Form -->
    <div class="form-container" id="team-leader-login">
        <h2>Team Leader Login</h2>
        <input type="text" id="login-team-leader-username" placeholder="Username" required>
        <input type="password" id="login-team-leader-password" placeholder="Password" required>
        <button onclick="loginTeamLeader()">Login</button>
        <button onclick="showRoleSelection()">Back</button>
    </div>

    <!-- User Home -->
    <div class="container" id="user-home">
        <h2>User Home</h2>
        <button onclick="showJoinTeam()">Join Team</button>
        <button onclick="logoutUser()">Logout</button>
    </div>

    <!-- Team Leader Home -->
    <div class="container" id="team-leader-home">
        <h2>Team Leader Home</h2>
        <button onclick="showCreateTeam()">Create Team</button>
        <button onclick="showNotifications()">View Notifications</button>
        <button onclick="showHistory()">View History</button>
        <button onclick="logoutTeamLeader()">Logout</button>
    </div>

    <!-- Create Team Form -->
    <div class="form-container" id="create-team">
        <h2>Create Team</h2>
        <input type="text" id="team-code" placeholder="Team Code" required>
        <input type="password" id="team-password" placeholder="Team Password" required>
        <button onclick="createTeam()">Create Team</button>
        <button onclick="showTeamLeaderHome()">Back</button>
    </div>

    <!-- Join Team Form -->
    <div class="form-container" id="join-team">
        <h2>Join Team</h2>
        <input type="text" id="join-team-code" placeholder="Team Code" required>
        <input type="password" id="join-team-password" placeholder="Team Password" required>
        <button onclick="requestJoinTeam()">Send Join Request</button>
        <button onclick="showUserHome()">Back</button>
    </div>

    <!-- Team Leader Notifications -->
    <div class="container" id="team-leader-notifications">
        <h2>Team Leader Notifications</h2>
        <ul id="notifications-list"></ul>
        <button onclick="showTeamLeaderHome()">Back</button>
    </div>

    <!-- Team Leader History -->
    <div class="container history-container" id="team-leader-history">
        <h2>Team Leader History</h2>
        <ul id="history-list"></ul>
        <button onclick="showTeamLeaderHome()">Back</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load data from local storage
            loadData();
            showRoleSelection();
        });

        function loadData() {
            const usersData = localStorage.getItem('users');
            const teamsData = localStorage.getItem('teams');
            const historyData = localStorage.getItem('history');
            const notificationsData = localStorage.getItem('notifications');

            window.users = usersData ? JSON.parse(usersData) : [];
            window.teams = teamsData ? JSON.parse(teamsData) : {};
            window.history = historyData ? JSON.parse(historyData) : {};
            window.notifications = notificationsData ? JSON.parse(notificationsData) : {};
        }

        function saveData() {
            localStorage.setItem('users', JSON.stringify(window.users));
            localStorage.setItem('teams', JSON.stringify(window.teams));
            localStorage.setItem('history', JSON.stringify(window.history));
            localStorage.setItem('notifications', JSON.stringify(window.notifications));
        }

        function showRoleSelection() {
            hideAll();
            document.getElementById('role-selection').style.display = 'block';
        }

        function showUserSignup() {
            hideAll();
            document.getElementById('user-signup').style.display = 'block';
        }

        function showTeamLeaderSignup() {
            hideAll();
            document.getElementById('team-leader-signup').style.display = 'block';
        }

        function showUserLogin() {
            hideAll();
            document.getElementById('user-login').style.display = 'block';
        }

        function showTeamLeaderLogin() {
            hideAll();
            document.getElementById('team-leader-login').style.display = 'block';
        }

        function showUserHome() {
            hideAll();
            document.getElementById('user-home').style.display = 'block';
        }

        function showTeamLeaderHome() {
            hideAll();
            document.getElementById('team-leader-home').style.display = 'block';
        }

        function showCreateTeam() {
            hideAll();
            document.getElementById('create-team').style.display = 'block';
        }

        function showJoinTeam() {
            hideAll();
            document.getElementById('join-team').style.display = 'block';
        }

        function showNotifications() {
            hideAll();
            document.getElementById('team-leader-notifications').style.display = 'block';
            updateNotifications();
        }

        function showHistory() {
            hideAll();
            document.getElementById('team-leader-history').style.display = 'block';
            updateHistory();
        }

        function signupUser() {
            const username = document.getElementById('user-username').value;
            const email = document.getElementById('user-email').value;
            const organization = document.getElementById('user-org').value;
            const password = document.getElementById('user-password').value;

            if (window.users.find(user => user.username === username || user.email === email)) {
                showMessage('Username or email already exists');
                return;
            }

            window.users.push({ username, email, organization, password, role: 'user', team: null });
            saveData();
            showMessage('User signed up successfully');
            showUserLogin();
        }

        function signupTeamLeader() {
            const username = document.getElementById('team-leader-username').value;
            const email = document.getElementById('team-leader-email').value;
            const organization = document.getElementById('team-leader-org').value;
            const password = document.getElementById('team-leader-password').value;

            if (window.users.find(user => user.username === username || user.email === email)) {
                showMessage('Username or email already exists');
                return;
            }

            window.users.push({ username, email, organization, password, role: 'team-leader' });
            saveData();
            showMessage('Team Leader signed up successfully');
            showTeamLeaderLogin();
        }

        function loginUser() {
            const username = document.getElementById('login-user-username').value;
            const password = document.getElementById('login-user-password').value;
            const user = window.users.find(user => user.username === username && user.password === password && user.role === 'user');

            if (!user) {
                showMessage('Invalid username or password');
                return;
            }

            if (user.team === null) {
                showMessage('You are not a member of any team');
                return;
            }

            showMessage('User logged in successfully');
            showUserHome();
        }

        function loginTeamLeader() {
            const username = document.getElementById('login-team-leader-username').value;
            const password = document.getElementById('login-team-leader-password').value;
            const leader = window.users.find(user => user.username === username && user.password === password && user.role === 'team-leader');

            if (!leader) {
                showMessage('Invalid username or password');
                return;
            }

            showMessage('Team Leader logged in successfully');
            showTeamLeaderHome();
        }

        function requestJoinTeam() {
            const teamCode = document.getElementById('join-team-code').value;
            const teamPassword = document.getElementById('join-team-password').value;
            const team = window.teams[teamCode];

            if (!team || team.teamPassword !== teamPassword) {
                showMessage('Invalid team code or password');
                return;
            }

            const username = document.getElementById('login-user-username').value;
            const user = window.users.find(user => user.role === 'user' && user.username === username);

            if (user.team !== null) {
                showMessage('You are already in a team');
                return;
            }

            if (team.requests.includes(username)) {
                showMessage('Join request already sent');
                return;
            }

            team.requests.push(username);
            saveData();
            showMessage('Join request sent successfully');
            if (!window.history[team.leader]) {
                window.history[team.leader] = [];
            }
            window.history[team.leader].push(`Join request from user ${username} for team ${teamCode}`);
            saveData();
            showUserHome();
        }

        function createTeam() {
            const teamCode = document.getElementById('team-code').value;
            const teamPassword = document.getElementById('team-password').value;
            const leaderUsername = document.getElementById('login-team-leader-username').value;
            const leader = window.users.find(user => user.role === 'team-leader' && user.username === leaderUsername);

            if (window.teams[teamCode]) {
                showMessage('Team code already exists');
                return;
            }

            window.teams[teamCode] = { teamPassword, leader: leader.username, members: [], requests: [] };
            saveData();
            showMessage('Team created successfully');
            if (!window.history[leader.username]) {
                window.history[leader.username] = [];
            }
            window.history[leader.username].push(`Created team: ${teamCode}`);
            saveData();
            showTeamLeaderHome();
        }

        function approveRequest(username, teamCode) {
            const team = window.teams[teamCode];
            if (!team) {
                showMessage('Invalid team code');
                return;
            }

            if (!team.requests.includes(username)) {
                showMessage('No join request found');
                return;
            }

            team.requests = team.requests.filter(request => request !== username);
            team.members.push(username);
            const user = window.users.find(user => user.username === username);
            if (user) {
                user.team = teamCode;
            }
            saveData();
            showMessage('Join request approved');
            if (!window.history[team.leader]) {
                window.history[team.leader] = [];
            }
            window.history[team.leader].push(`User ${username} joined team: ${teamCode}`);
            saveData();
            showTeamLeaderHome();
        }

        function denyRequest(username, teamCode) {
            const team = window.teams[teamCode];
            if (!team) {
                showMessage('Invalid team code');
                return;
            }

            if (!team.requests.includes(username)) {
                showMessage('No join request found');
                return;
            }

            team.requests = team.requests.filter(request => request !== username);
            saveData();
            showMessage('Join request denied');
            if (!window.history[team.leader]) {
                window.history[team.leader] = [];
            }
            window.history[team.leader].push(`Join request from user ${username} denied for team: ${teamCode}`);
            saveData();
            showTeamLeaderHome();
        }

        function updateNotifications() {
            const leaderUsername = document.getElementById('login-team-leader-username').value;
            const notificationsList = document.getElementById('notifications-list');
            notificationsList.innerHTML = '';
            const teamCodes = Object.keys(window.teams);
            teamCodes.forEach(teamCode => {
                const team = window.teams[teamCode];
                if (team.leader === leaderUsername) {
                    team.requests.forEach(request => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `Request from ${request} for team ${teamCode}`;
                        const approveButton = document.createElement('button');
                        approveButton.textContent = 'Approve';
                        approveButton.onclick = () => approveRequest(request, teamCode);
                        const denyButton = document.createElement('button');
                        denyButton.textContent = 'Deny';
                        denyButton.onclick = () => denyRequest(request, teamCode);
                        listItem.appendChild(approveButton);
                        listItem.appendChild(denyButton);
                        notificationsList.appendChild(listItem);
                    });
                }
            });
        }

        function updateHistory() {
            const leaderUsername = document.getElementById('login-team-leader-username').value;
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            if (window.history[leaderUsername]) {
                window.history[leaderUsername].forEach(entry => {
                    const listItem = document.createElement('li');
                    listItem.textContent = entry;
                    historyList.appendChild(listItem);
                });
            }
        }

        function logoutUser() {
            showMessage('User logged out');
            showRoleSelection();
        }

        function logoutTeamLeader() {
            showMessage('Team Leader logged out');
            showRoleSelection();
        }

        function showMessage(message) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        function hideAll() {
            document.querySelectorAll('.container, .form-container, .history-container').forEach(element => {
                element.style.display = 'none';
            });
        }
    </script>
</body>
</html>
